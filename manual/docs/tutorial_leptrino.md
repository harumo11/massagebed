# 力覚センサのチュートリアル

x,y,z方向の力とトルクを検出する力覚センサがロボットの手先に接続されています．
本チュートリアルでは，このセンサから情報を取り出す手順について説明します．
この力覚センサはLeptrinoという商品です．

## チュートリアル
### ドライバーのインストール
**LinuxではドライバーなしでLeptrinoと通信することが可能です．
そのため，下記の手順はWindowsだけ実行してください．**

1. すでにLeptrionoがPCに接続してある場合には，抜いておいてください．
1. LeptrinoのDVD内にあるドライバーをダブルクリックしてインストールしてください．
このとき自分の使用しているPCが64bitか32bitかによってインストールするドライバーが異なるので
注意してください．自分がどちらを選択すればよいかわからない場合は64bitを選択してください．
1. LeptrinoをPCに接続してください．
1. テスト用ののビジュアライザーを起動し，データが正しく送られてきているかを確認してください．

### プログラムの実行
1. `leptrino_force_torque`を実行してください．このプログラムはセンサーから得た情報をTCP通信で
送ってくれるものになります．そのためTCPクライアントを作成し，`192.168.10.1`の`50010`にアクセス
すると力覚情報を受け取ることができます．今回は既存のTCPクライアントを使用して情報を受け取ります．
1. `leptrino_test_client`を実行してください．力覚センサから得られた情報が表示されます．

## 力覚情報の処理
`leptrino_force_torque`からは力覚情報を含む文字列が送られてきます．そのためその文字列を
プログラム中で分解し，力とトルクの値を得る必要があります．

### プロトコル
`leptrino_force_torque`からは`DATA:Fx,Fy,Fz,Tx,Ty,Tz:`という文字列が送られてきます．
この`Fx`や`Ty`はx軸方向の力やy軸周りのトルクを指し示しており，実際には計測された
数値が入ります．具体的には，`DATA:0.1,-0.4,4.223,-0.32,0.5998,0.023:`のような文字列が
送られてきます．そのため，開発者は送られてきたデータの最初から`DATA:`を取り除きます．
そして，残った文字列から`:`を見つけ出し，そこまでを1つのメッセージとします．
このようなプロトコルが必要となった背景には，ネットワークの遅延が影響があります．
ネットワークが遅く，受信するまでに時間がかかると2つのデータが途中で連結されて1つのデータ
として受信してしまうことがあります．それを避けるために1つのデータの最初と終わりに
特徴的な文字列を追加することにより，データが結合してしまうことを防いでいます．

### バイアス除去
無事，力とトルクデータだけを抽出できたとしても，そのままデータ制御に使用することはできません．
力覚センサの計測データにはバイアスが入っているため，これを取り除く必要があります．
まず，力覚センサになんの力も作用しない状態にします．本来であれば計測される力とトルクは
すべて０を示すはずです．ただ，実際は０にはなりません．この本来は０であるべきなのに観測
されてしまうデータのことをバイアスと呼びます．
バイアスを取り除くためには，それを計測データから差し引くことが必要になります．

## トラブルシューティング

- 受信した信号に`nan`が含まれたり，`leptrino_force_torque`起動時に表示される
情報に文字化けが含まれる場合には力覚センサのUSBをPCから外し，もう一度差し込んでください．
